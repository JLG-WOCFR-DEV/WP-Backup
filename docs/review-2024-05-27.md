# Revue du plugin Backup JLG

Cette note était initialement datée du 27 mai 2024. Les points suivants tracent l'évolution depuis cette revue et les nouveaux sujets à surveiller.

## ✅ Problèmes résolus depuis la revue initiale
- **Capacités respectées partout** : les handlers AJAX et REST sensibles appellent désormais `bjlg_can_manage_plugin()`/`bjlg_get_required_capability()` au lieu de supposer `manage_options`, ce qui redonne la main aux rôles personnalisés.【F:backup-jlg/includes/class-bjlg-settings.php†L844-L940】
- **Valeurs par défaut consolidées** : le tableau `$default_settings` est unifié et les sections dropbox/onedrive/pcloud ne sont plus dupliquées, évitant tout écrasement silencieux.【F:backup-jlg/includes/class-bjlg-settings.php†L31-L118】
- **Chart.js livré en local** : `enqueue_admin_assets()` référence `assets/js/vendor/chart.umd.min.js` empaqueté dans le plugin et versionné via `filemtime()`, supprimant la dépendance CDN soulevée lors de la revue.【F:backup-jlg/backup-jlg.php†L256-L289】
- **Fallback CSS explicite** : chaque règle utilisant `color-mix()` conserve une déclaration `border` classique juste avant, assurant un rendu correct sur les navigateurs dépourvus de ce support.【F:backup-jlg/assets/css/admin.css†L133-L152】
- **Observabilité des files** : le tableau de bord expose désormais les files de purge distante et de notifications (volumétrie, prochaines tentatives, erreurs) via un panneau dédié, ce qui répond au manque de monitoring remonté lors de la revue.【F:backup-jlg/includes/class-bjlg-admin.php†L365-L459】【F:backup-jlg/includes/class-bjlg-admin-advanced.php†L43-L231】【F:backup-jlg/assets/css/admin.css†L312-L404】

## 🚧 Points de vigilance actuels
- **Purge distante perfectible** : le worker `BJLG_Remote_Purge_Worker` traite bien la file `bjlg_process_remote_purge_queue`, mais ne gère ni backoff exponentiel, ni seuil maximal d'essais, ni alerte UI dédiée. Les entrées en échec risquent donc de tourner en boucle sans visibilité côté admin.【F:backup-jlg/includes/class-bjlg-remote-purge-worker.php†L12-L166】
- **Canaux de notification limités** : seul le trio email/Slack/Discord dispose d’un transport dédié dans `BJLG_Notification_Transport`. Avant de communiquer sur Telegram, SMS ou d’autres chatops, prévoir l’implémentation correspondante pour éviter les gaps fonctionnels.【F:backup-jlg/includes/class-bjlg-notification-transport.php†L13-L154】【F:backup-jlg/includes/class-bjlg-settings.php†L40-L115】
- ~~**Absence de monitoring de file** : ni la queue des notifications (`bjlg_notification_queue`) ni celle de purge distante ne disposent d’un écran de suivi (nombre d’entrées, dernier échec, prochain passage). Ajouter un widget d’observation faciliterait le debug en production et alignerait le plugin sur les consoles pro.~~ ✅ Résolu par le panneau « Files d’attente » du tableau de bord décrit ci-dessus.【F:backup-jlg/includes/class-bjlg-admin.php†L365-L459】

## Actions recommandées
1. Implémenter un mécanisme de retries graduels + seuil d’abandon côté purge distante, avec alerting (mail/webhook) lorsque le nombre d’essais dépasse la limite.
2. Masquer ou désactiver les canaux non implémentés dans l’UI tant que le transport n’est pas livré, ou prioriser leur développement pour aligner la promesse produit sur la réalité technique.
3. Étendre le panneau « Files d’attente » avec des actions correctives (relance manuelle, purge d’une entrée) et des notifications automatiques en cas de saturation.
